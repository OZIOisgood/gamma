---
config:
  theme: dark
  themeVariables:
    edgeLabelBackground: '#121212'
    edgeLabelColor: '#ffffff'
---
flowchart TB
    subgraph Client ["Client Side"]
        direction TB
        User["ğŸ‘¤ User"] -- Uses --> Dashboard["ğŸ’» Dashboard<br>(Angular)"]
    end

    Dashboard -- "1. Request Upload URL" --> API["âš™ï¸ API Service<br>(Go)"]
    API -- "2. Create Pending Record" --> DB[("ğŸ˜ PostgreSQL<br>(Database)")]
    API -- "3. Return Presigned URL" --> Dashboard
    Dashboard -- "4. Direct Upload" --> MinIO[("ğŸ—„ï¸ MinIO<br>(S3 Storage)")]
    MinIO -. "5. Event: Uploaded" .-> NATS["ğŸ“¨ NATS<br>(JetStream)"]
    
    subgraph WorkerPool ["âš¡ Scalable Worker Pool"]
        direction LR
        Worker["ğŸ› ï¸ Worker 1<br>(Go)"]
        Worker2["ğŸ› ï¸ Worker 2..N<br>(Go)"]
    end

    NATS -- "6. Consume Job" --> Worker
    NATS -.- Worker2

    Worker <-- "7. Process with FFmpeg" --> MinIO
    Worker -- "8. Upload HLS" --> MinIO
    Worker -- "9. Update Status" --> DB
    Worker -- "10. Event: Processed" --> NATS
    NATS -- "11. Notify" --> API
    API -- "12. WebSocket Msg" --> Dashboard

     User:::user
     Dashboard:::angular
     API:::go
     Worker:::go
     Worker2:::go
     MinIO:::storage
     NATS:::messaging
     DB:::db

     style WorkerPool fill:transparent,stroke:#00bcd4,stroke-width:2px,stroke-dasharray: 5 5,color:#fff
     style Client fill:transparent,stroke:#90a4ae,stroke-width:2px,stroke-dasharray: 5 5,color:#fff
    
    classDef user fill:#37474f,stroke:#90a4ae,stroke-width:2px,color:#fff
    classDef angular fill:#880e4f,stroke:#f50057,stroke-width:2px,color:#fff
    classDef go fill:#006064,stroke:#00bcd4,stroke-width:2px,color:#fff
    classDef storage fill:#b71c1c,stroke:#ff5252,stroke-width:2px,color:#fff
    classDef messaging fill:#1b5e20,stroke:#66bb6a,stroke-width:2px,color:#fff
    classDef db fill:#1a237e,stroke:#7986cb,stroke-width:2px,color:#fff
